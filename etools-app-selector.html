<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../paper-material/paper-material.html">
<link rel="import" href="../paper-styles/color.html">
<link rel="import" href="../iron-collapse/iron-collapse.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="app-selector-icons.html">
<link rel="import" href="../iron-icons/device-icons.html">

<!--
`etools-app-selector`
App selector menu

@demo demo/index.html
-->

<dom-module id="etools-app-selector">
  <style>
    :host {
          --paper-icon-button: {
            box-sizing: content-box !important;
          };
        }

        paper-icon-button.apps-button {
          @apply --layout-horizontal;
          width: 24px;
          height: 24px;
          padding: 18px 24px 18px 24px;
          color: var(--header-secondary-text-color, rgba(255, 255, 255, 0.7));
          border-right: 1px solid var(--light-divider-color, rgba(255, 255, 255, 0.12));
          z-index: 100;
          box-sizing: content-box !important;
        }

        paper-icon-button.icon-opened {
          background: #ffffff;
          color: var(--dark-primary-text-color, rgba(0, 0, 0, 0.87));
        }

        .container {
          @apply --layout-vertical;
          position: relative;
        }

        .apps-select {
          position: absolute;
          background: var(--primary-element-background, #FFFFFF);
          top: 60px;
          z-index: 100;
          padding: 0;
        }

        .content-wrapper {
          @apply --layout-center;
          min-height: 60px;
          padding: 24px 4px;
          box-sizing: border-box;
          font-size: 14px;
          text-align: center;
          white-space: nowrap;
          border-bottom: 1px solid rgba(0, 0, 0, 0.12);
          border-right: 1px solid rgba(0, 0, 0, 0.12);
        }

        .content-wrapper-2 {
          @apply --layout-center;
          display: flex;
          height: 37px;
          box-sizing: border-box;
          font-size: 12px;
          white-space: nowrap;
          border-bottom: 1px solid rgba(0, 0, 0, 0.12);
          border-right: 1px solid rgba(0, 0, 0, 0.12);
        }

        paper-icon-button.panel-icon {
          width: 72px;
          height: 72px;
          padding: 0;
        }

        iron-icon.unpp-icon {
          height: 32px;
          width: 104px;
        }

        .panel {
          width: 120px;
        }

        .panel:hover {
          background: var(--app-selector-item-hover-color, #eeeeee);
        }

        .panel-row {
          @apply --layout-horizontal;
        }

        .app-title {
          font-size: 12px;
          text-transform: uppercase;
          font-weight: 500;
          padding-top: 6px;
          text-align: center;
          line-height: 1.2;
          cursor: pointer;
          white-space: normal;
        }

        .app-outer {
          width: 360px;
          display: block;
        }

        iron-icon.bottom-icon {
          --iron-icon-height: 20px;
          --iron-icon-width: 20px;
          --iron-icon-fill-color: #9e9e9e;
          padding-right: 4px;
        }

        .weight-500 {
          font-weight: 500;
          padding-right: 4px;
        }

        .display-flex {
          display: flex;
          align-items: center;
        }

        .app-inner {
          display: flex;
          flex-flow: wrap;
        }

        .unpp-section {
          background-color: rgb(76, 121, 179);
          display: flex;
          align-items: center;
          width: 100%;
          height: 100%;
          padding-left: 8px;
        }

        .logo {
          width: 104px;
          height: 32px;
          margin-right: 8px;
          margin-left: 8px;
        }

        .top-content {
          display: flex;
          height: 56px;
          flex-direction: row;
          align-items: center;
          border-bottom: 1px solid rgba(0, 0, 0, 0.12);
        }
        
        .admin {
          width: 240px;
          padding-left: 12px
        }

        a, a:link, a:visited, a:hover, a:active {
          color: var(--app-selector-text-color, rgba(0, 0, 0, 0.87));
          text-decoration: none;
        }

  </style>
  <template>
    <div class="container" id="etools-selector">
      <paper-icon-button on-tap="toggleMenu" class$="apps-button [[opened]]" icon="apps"></paper-icon-button>
      <iron-collapse id="selector" class="apps-select">
        <div class="paper-material" elevation="5">
          <div class="top-content">
            <div class="panel">
              <iron-icon class="logo"
                         icon="etools-logo:logo">
              </iron-icon>
            </div>
            <a class="unpp-section" href="https://www.unpartnerportal.org/login" target="_blank">
              <iron-icon class="logo"
                         icon="unppIcon:unpp">
              </iron-icon>
            </a>
          </div>
          <div class="app-outer">
            <div class="app-inner">
              <template is="dom-repeat" items="[[menuOptions]]" as="app">
                <div class="panel-row">
                  <div class="content-wrapper panel">
                    <a on-tap="goToPage" href="[[baseSite]]/[[app.url]]/">
                      <paper-icon-button class="panel-icon"
                                         icon="[[app.icon]]"></paper-icon-button>
                    </a>
                    <a on-tap="goToPage" href="[[baseSite]]/[[app.url]]/">
                      <div class="app-title">[[app.title]]</div>
                    </a>
                  </div>
                </div>
              </template>
            </div>
          </div>
          <div class="content-wrapper-2">
            <a class="display-flex admin" on-tap="goToAdmin" href="[[baseSite]]/admin/">
              <iron-icon class="bottom-icon" 
                         icon="admin-icon:adminIcon">
              </iron-icon>
              <span class="weight-500">ADMIN</span>(Permission Required)
            </a>
            <!-- DATAMART ICON TO BE ENABLED WHEN BUSINESS REQUESTS -->
            <!-- <a class="datamart"><iron-icon class="bottom-icon" icon="device:storage"></iron-icon>
              <a on-tap="goToPage" href="https://datamart.unicef.io" target="_blank"><span class="weight-500">DATAMART</span></a>
            </a> -->
          </div>
        </div>
      </iron-collapse>
    </div>
  </template>
  <script>
    Polymer({
      is: 'etools-app-selector',
      properties: {

        baseSite: {
          type: String,
          value: window.location.origin,
        },

        /**
         * Class name toggle variable.
         * Used for styling when dropdown open/closed
         */
        opened: {
          type: String,
          value: '',
        },

        /**
         * Dropdown menu items to display.
         *
         * Example object structure:
         *
         *     menuOptions = [{
         *       title: 'Dashboard',
         *       icon: 'app-selector-icons: dashIcon',
         *       url: 'dash'
         *     }]
         *
         * @type (ArrayBuffer|ArrayBufferView|Blob|Document|FormData|null|string|undefined|Object)
         */

        menuOptions: {
          type: Array,
          value: [
            {
              title: 'Dashboards',
              icon: 'app-selector-icons:dashIcon',
              url: 'dash'
            },
            {
              title: 'Partnership Management',
              icon: 'app-selector-icons:pmpIcon',
              url: 'pmp'
            },
            {
              title: 'Trip Management',
              icon: 'app-selector-icons:tripsIcon',
              url: 't2f'
            },
            {
              title: 'Financial Assurance',
              icon: 'app-selector-icons:famIcon',
              url: 'ap'
            },
            {
              title: 'Third Party Monitoring',
              icon: 'app-selector-icons:tpmIcon',
              url: 'tpm'
            },
            {
              title: 'Action Points',
              icon: 'app-selector-icons:apdIcon',
              url: 'apd'
            },
          ],
          notify: true,
        }
      },

      attached: function() {
        document.addEventListener('click', this._onCaptureClick.bind(this), true);
      },

      /**
       * Toggles the menu opened and closed
       *
       */
      toggleMenu: function() {
        this.$.selector.toggle();
        if (this.opened) {
          this.opened = '';
        } else {
          this.opened = 'icon-opened';
        }
      },

      /**
      * Navigate window to path if ctrl/command are not pressed
      */
      manageClickEvent: function(e, path) {
        if (!e.detail.sourceEvent.ctrlKey && !e.detail.sourceEvent.metaKey) {
          window.location.href = path;
        }
      },

      /**
       * Change location to target app url found in menuOptions array items.
       * Url prop of item should just be app name
       *
       * Example:
       *
       *  `app.url="admin" will change location to 'http://myBaseUrlAndPort/admin/' `
       *
       */

      goToPage: function(e) {
        var path = window.location.origin + '/' + e.model.app.url + '/';
        this.manageClickEvent(e, path);
      },

      goToAdmin: function(e){
        var path = window.location.origin + '/admin/';
        this.manageClickEvent(e, path);
      },

      /**
       * Determine if click is outside of menu, close if true
       *
       */
    
      _onCaptureClick: function(e) {
        if (!this._isInPath(Polymer.dom(e).path, 'id', 'etools-selector')) {
          if (this.$.selector.opened) {
            this.toggleMenu();
          }
        }
      },

      _isInPath: function(path, prop, value) {
        path = path || [];
        for (var i = 0; i < path.length; i++) {
          if (path[i][prop] === value) {
            return true;
          }
        }
        return false;
      },
    });
  </script>
</dom-module>